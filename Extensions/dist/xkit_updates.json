{"id":"xkit_updates","script":"//* TITLE XKit Updates **//\n//* VERSION 2.1.1 **//\n//* DESCRIPTION Provides automatic updating of extensions **//\n//* DEVELOPER new-xkit **//\nXKit.extensions.xkit_updates = new Object({\n\n\trunning: false,\n\n\tdefault_interval: 18000000,\n\tmin_interval: 3600000,\n\tmax_interval: 86400000,\n\n\tpreferences: {\n\t\t\"show_notifications\": {\n\t\t\ttext: \"Show update notifications\",\n\t\t\tdefault: true,\n\t\t\tvalue: true\n\t\t},\n\t\t\"check_interval\": {\n\t\t\ttext: \"Update check interval (in milliseconds)\",\n\t\t\tdefault: \"18000000\",\n\t\t\tvalue: \"18000000\",\n\t\t\ttype: \"text\"\n\t\t},\n\t},\n\n\trun: function() {\n\t\ttry {\n\t\t\tXKit.tools.init_css(\"xkit_updates\");\n\t\t\tthis.running = true;\n\t\t\tvar ms = (new Date()).getTime();\n\t\t\tvar last_time = parseFloat(XKit.storage.get(\"xkit_updates\", \"last_update_check\", \"0\"));\n\t\t\tvar difference = ms - last_time;\n\t\t\tconsole.log(\"Updates: difference = \" + difference);\n\t\t\tif (isNaN(XKit.extensions.xkit_updates.preferences.check_interval.value) === true) {\n\t\t\t\tconsole.log(\"Invalid check interval, reverting to default: not a number.\");\n\t\t\t\tXKit.extensions.xkit_updates.preferences.check_interval.value = XKit.extensions.xkit_updates.default_interval;\n\t\t\t} else {\n\t\t\t\tvar m_interval = XKit.extensions.xkit_updates.preferences.check_interval.value;\n\t\t\t\tif (m_interval > XKit.extensions.xkit_updates.max_interval || m_interval < XKit.extensions.xkit_updates.min_interval) {\n\t\t\t\t\tXKit.extensions.xkit_updates.preferences.check_interval.value = XKit.extensions.xkit_updates.default_interval;\n\t\t\t\t\tconsole.log(\"Invalid check interval, reverting to default: too small or big.\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (difference <= -1 || difference >= XKit.extensions.xkit_updates.preferences.check_interval.value) {\n\t\t\t\tconsole.log(\"Starting update checking..\");\n\t\t\t\tXKit.extensions.xkit_updates.get_list();\n\t\t\t} else {\n\t\t\t\tconsole.log(\"Skipping update checking.\");\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tXKit.extensions.xkit_updates.show_update_failure();\n\t\t}\n\t},\n\n\tto_update: \"\",\n\tto_update_index: 0,\n\tupdated_list: \"\",\n\tupdated_list_versions: \"\",\n\n\tget_list: function(force_mode) {\n\n\t\tif (force_mode) {\n\t\t\t$(\"#xkit-forced-auto-updates-message\").html(\"Fetching the latest changes from XKit servers...\");\n\t\t}\n\n\t\tXKit.download.page(\"list.php\", function(mdata) {\n\n\t\t\tif (mdata.server_down === true) {\n\n\t\t\t\tXKit.extensions.xkit_updates.show_update_failure();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tXKit.extensions.xkit_updates.to_update_index = 0;\n\t\t\tXKit.extensions.xkit_updates.to_update = [];\n\t\t\tXKit.extensions.xkit_updates.updated_list = [];\n\t\t\tXKit.extensions.xkit_updates.updated_list_versions = [];\n\n\t\t\tfor (var extension in mdata.extensions) {\n\n\t\t\t\tif (force_mode) {\n\n\t\t\t\t\tvar check_this = false;\n\t\t\t\t\tif (XKit.installed.check(mdata.extensions[extension].name)) {\n\n\t\t\t\t\t\tif (XKit.extensions.xkit_updates.shouldUpdate(XKit.tools.parse_version(XKit.installed.get(mdata.extensions[extension].name).version), XKit.tools.parse_version(mdata.extensions[extension].version))) {\n\t\t\t\t\t\t\tcheck_this = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (mdata.extensions[extension].name.substring(0, 5) === \"xkit_\") {\n\t\t\t\t\t\t\t// Always update internals no matter what.\n\t\t\t\t\t\t\tcheck_this = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (check_this) {\n\t\t\t\t\t\t\tXKit.extensions.xkit_updates.to_update.push(mdata.extensions[extension].name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tif (XKit.installed.check(mdata.extensions[extension].name)) {\n\t\t\t\t\t\tif (XKit.extensions.xkit_updates.shouldUpdate(XKit.tools.parse_version(XKit.installed.get(mdata.extensions[extension].name).version), XKit.tools.parse_version(mdata.extensions[extension].version))) {\n\t\t\t\t\t\t\tXKit.extensions.xkit_updates.to_update.push(mdata.extensions[extension].name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif (XKit.extensions.xkit_updates.to_update.length > 0) {\n\t\t\t\t$(\"body\").append(\"<div id=\\\"xkit-updating-indicator\\\">XKit Auto-Update</div>\");\n\t\t\t\tif (force_mode) {\n\t\t\t\t\t$(\"#xkit-forced-auto-updates-message\").html(\"Downloading extensions from the servers...\");\n\t\t\t\t}\n\t\t\t\tXKit.extensions.xkit_updates.update_next(force_mode);\n\t\t\t} else {\n\t\t\t\tvar ms = (new Date()).getTime();\n\t\t\t\tXKit.storage.set(\"xkit_updates\", \"last_update_check\", ms);\n\t\t\t\tconsole.log(\"Update complete: no new extensions\");\n\t\t\t}\n\n\t\t});\n\n\t},\n\n\tshow_update_failure: function() {\n\n\t\tXKit.notifications.add(\"<b>Could not update New XKit:</b><br/>\" +\n\t\t\t\"I could not reach the New XKit servers to update myself. \" +\n\t\t\t\"You might be running an old and buggy version of New XKit. Click here for details.\",\n\t\t\t\"error\", true, function() {\n\n\t\t\t\tXKit.window.show(\"Auto-Update failed.\",\n\n\t\t\t\t\t\"New XKit automatically updates itself from time to time in the background \" +\n\t\t\t\t\t\"to bring you the latest features and bug fixes. Unfortunately, it was \" +\n\t\t\t\t\t\"unable to contact the servers and download the latest updates. This \" +\n\t\t\t\t\t\"might be a temporary server error or a problem with your connection.\" +\n\t\t\t\t\t\"<br/><br/>\" +\n\t\t\t\t\t\"Press continue below to start troubleshooting. <b>It's important to fix this issue</b> - \" +\n\t\t\t\t\t\"if you don't, you'll be running an out-of-date version of New XKit, \" +\n\t\t\t\t\t\"which might not work properly and cause problems.\",\n\n\t\t\t\t\t\"error\",\n\n\t\t\t\t\t'<div class=\"xkit-button default\" id=\"xkit-updates-troubleshooting\">Continue &rarr;</div>' +\n\t\t\t\t\t'<a href=\"https://new-xkit-extension.tumblr.com\" class=\"xkit-button\">New XKit Blog</a>' +\n\t\t\t\t\t'<a href=\"https://new-xkit-support.tumblr.com\" class=\"xkit-button\">New XKit Support</a>' +\n\t\t\t\t\t'<div class=\"xkit-button\" id=\"xkit-close-message\">OK</div>'\n\t\t\t\t);\n\n\t\t\t\t$(\"#xkit-updates-troubleshooting\").click(function() {\n\n\t\t\t\t\tXKit.window.show(\"Troubleshooting\",\n\n\t\t\t\t\t\t\"<b>Part 1: The Exact Problem</b>\" +\n\t\t\t\t\t\t\"<br/><br/>\" +\n\t\t\t\t\t\t\"If you're reading this, New XKit failed to reach our GitHub Pages site at\" +\n\t\t\t\t\t\t\"<p>https://new-xkit.github.io/XKit/</p>\" +\n\t\t\t\t\t\t\"and produced an error notification. However, we can't figure out what's gone wrong \" +\n\t\t\t\t\t\t\"without your help, since a few things can cause it.\" +\n\t\t\t\t\t\t\"<br/><br/>\" +\n\t\t\t\t\t\t\"The first thing to check is if GitHub is down. If GitHub Status reports \" +\n\t\t\t\t\t\t\"100%, press continue. If not, sit tight - this outage will be temporary.\",\n\n\t\t\t\t\t\t\"question\",\n\n\t\t\t\t\t\t'<a class=\"xkit-button default\" href=\"https://status.github.com\" target=\"_blank\">GitHub Status</a>' +\n\t\t\t\t\t\t'<div class=\"xkit-button\" id=\"xkit-updates-troubleshooting-2\">Continue &rarr;</div>' +\n\t\t\t\t\t\t'<div class=\"xkit-button\" id=\"xkit-close-message\">Close</div>'\n\t\t\t\t\t);\n\n\t\t\t\t\t$(\"#xkit-updates-troubleshooting-2\").click(function() {\n\n\t\t\t\t\t\tXKit.window.show(\"Troubleshooting\",\n\n\t\t\t\t\t\t\t\"<b>Part 2: Other Browser Add-ons</b>\" +\n\t\t\t\t\t\t\t\"<br/><br/>\" +\n\t\t\t\t\t\t\t\"The most common source of problems is other browser extensions, \" +\n\t\t\t\t\t\t\t\"such as ad- or script-blockers. Adblockers causing interference \" +\n\t\t\t\t\t\t\t\"is almost always temporary, so if you have one, try updating its \" +\n\t\t\t\t\t\t\t\"lists (through its own settings).\" +\n\t\t\t\t\t\t\t\"<br/><br/>\" +\n\t\t\t\t\t\t\t\"If you use a script blocker, be sure to add\" +\n\t\t\t\t\t\t\t\"<p style='display: inline-block; margin: 0 0.5em;>new-xkit.github.io</p>\" +\n\t\t\t\t\t\t\t\"to its whitelist.\" +\n\t\t\t\t\t\t\t\"<br/><br/>\" +\n\t\t\t\t\t\t\t\"<b>If you've already updated your adblocker's lists on three consecutive days</b>, or would like to \" +\n\t\t\t\t\t\t\t\"read on regardless, press continue.\",\n\n\t\t\t\t\t\t\t\"question\",\n\n\t\t\t\t\t\t\t'<div class=\"xkit-button default\" id=\"xkit-close-message\">OK</div>' +\n\t\t\t\t\t\t\t'<div class=\"xkit-button\" id=\"xkit-updates-troubleshooting-3\">Continue &rarr;</div>',\n\n\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\t$(\"#xkit-updates-troubleshooting-3\").click(function() {\n\n\t\t\t\t\t\t\tXKit.window.show(\"Troubleshooting\",\n\n\t\t\t\t\t\t\t\t\"<b>Part 3: Security Settings and Network Problems</b>\" +\n\t\t\t\t\t\t\t\t\"<br/><br/>\" +\n\t\t\t\t\t\t\t\t\"Try visiting our GitHub Pages site using the link below. \" +\n\t\t\t\t\t\t\t\t\"If your browser fails to display it, the error it gives you there \" +\n\t\t\t\t\t\t\t\t\"is what you need to tackle.\" +\n\t\t\t\t\t\t\t\t\"<br/><br/>\" +\n\t\t\t\t\t\t\t\t\"If that page displays normally, or if you would like help anyway, \" +\n\t\t\t\t\t\t\t\t\"please get in touch with us at New XKit Support.\",\n\n\t\t\t\t\t\t\t\t\"question\",\n\n\t\t\t\t\t\t\t\t'<a class=\"xkit-button default\" href=\"https://new-xkit.github.io/XKit\" target=\"_blank\">New XKit on GitHub Pages</a>' +\n\t\t\t\t\t\t\t\t'<a class=\"xkit-button\" href=\"https://new-xkit-support.tumblr.com\">New XKit Support</a>' +\n\t\t\t\t\t\t\t\t'<a class=\"xkit-button\" id=\"xkit-close-message\">OK</a>'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\n\t},\n\n\tupdate_next: function(force_mode) {\n\n\t\tif (XKit.extensions.xkit_updates.to_update_index >= XKit.extensions.xkit_updates.to_update.length) {\n\n\t\t\tvar ms = (new Date()).getTime();\n\t\t\tXKit.storage.set(\"xkit_updates\", \"last_update_check\", ms);\n\n\t\t\t// Completed all?\n\n\t\t\tif (!force_mode) {\n\n\t\t\t\tvar to_show = XKit.tools.get_setting(\"xkit_show_update_notifications\", \"true\");\n\n\t\t\t\tif (to_show === \"true\") {\n\t\t\t\t\tvar suffix = \"\";\n\n\t\t\t\t\tif (XKit.extensions.xkit_updates.updated_list.length !== 1) {\n\t\t\t\t\t\tsuffix = \"s\";\n\t\t\t\t\t}\n\n\t\t\t\t\tXKit.notifications.add(\"XKit updated \" + XKit.extensions.xkit_updates.updated_list.length + \" extension\" + suffix + \". Click here to view them.\", \"ok\", true, function() {\n\t\t\t\t\t\tvar m_result = \"\";\n\t\t\t\t\t\tfor (var i = 0; i < XKit.extensions.xkit_updates.updated_list.length; i++) {\n\t\t\t\t\t\t\tm_result = m_result + \"<br/>\" + XKit.extensions.xkit_updates.updated_list[i] + \" &middot; \" + XKit.extensions.xkit_updates.updated_list_versions[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tXKit.window.show(\"Auto-Update results\", \"<b>XKit updated the following extension\" + suffix + \":</b>\" + m_result, \"info\", \"<div class=\\\"xkit-button default\\\" id=\\\"xkit-close-message\\\">OK</div>\");\n\t\t\t\t\t});\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tXKit.window.show(\"Complete!\", \"<b>XKit updated all the extensions with version mismatch.</b><br/>Changes will be active when you refresh the page.\", \"info\", \"<div id=\\\"xkit-close-message\\\" class=\\\"xkit-button default\\\">OK</div>\");\n\n\t\t\t}\n\n\t\t\t$(\"#xkit-updating-indicator\").remove();\n\t\t\treturn;\n\t\t}\n\n\t\tif (force_mode) {\n\t\t\t$(\"#xkit-forced-auto-updates-message\").html(\"Downloading \" + XKit.extensions.xkit_updates.to_update[XKit.extensions.xkit_updates.to_update_index] + \" (\" + (XKit.extensions.xkit_updates.to_update_index + 1) + \" of \" + XKit.extensions.xkit_updates.to_update.length + \")\");\n\t\t}\n\n\n\t\tXKit.extensions.xkit_updates.update(XKit.extensions.xkit_updates.to_update[XKit.extensions.xkit_updates.to_update_index], function(mdata) {\n\n\t\t\tif (mdata.errors === true) {\n\t\t\t\tif (mdata.error_not_found === true) {\n\t\t\t\t\t// Probably removed.\n\t\t\t\t\tconsole.log(\"Can not update \" + XKit.extensions.xkit_updates.to_update[XKit.extensions.xkit_updates.to_update_index] + \": not found.\");\n\t\t\t\t} else {\n\t\t\t\t\tXKit.extensions.xkit_updates.show_update_failure();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tXKit.extensions.xkit_updates.updated_list.push(mdata.title);\n\t\t\tXKit.extensions.xkit_updates.updated_list_versions.push(mdata.version);\n\t\t\tconsole.log(\"Updated \" + XKit.extensions.xkit_updates.to_update[XKit.extensions.xkit_updates.to_update_index]);\n\t\t\tXKit.extensions.xkit_updates.to_update_index++;\n\t\t\tXKit.extensions.xkit_updates.update_next(force_mode);\n\n\t\t});\n\n\t},\n\n\tupdate: function(extension_id, callback) {\n\n\t\tvar m_result = {};\n\n\n\t\tXKit.install(extension_id, function(mdata) {\n\n\t\t\tif (mdata.errors) {\n\t\t\t\tif (mdata.storage_error === true) {\n\t\t\t\t\tm_result.errors = true;\n\t\t\t\t\tm_result.error = \"Can't store data on browser\";\n\t\t\t\t\tcallback(m_result);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (mdata.server_down === true) {\n\t\t\t\t\tm_result.errors = true;\n\t\t\t\t\tm_result.error = \"Can't reach servers\";\n\t\t\t\t\tcallback(m_result);\n\t\t\t\t} else {\n\t\t\t\t\tif (mdata.file === \"not_found\") {\n\t\t\t\t\t\tm_result.errors = true;\n\t\t\t\t\t\tm_result.error_not_found = true;\n\t\t\t\t\t\tm_result.error = \"Extension can't be found: It might've been removed from the extension gallery.\";\n\t\t\t\t\t\tcallback(m_result);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tm_result.errors = true;\n\t\t\t\t\t\tm_result.error = \"Unknown error. Code: #UPDATE-1026\";\n\t\t\t\t\t\tcallback(m_result);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\t// Try evaling the script.\n\t\t\t\t// If it's working, then move to the next one.\n\t\t\t\tm_result.errors = false;\n\t\t\t\tm_result.error = \"\";\n\t\t\t\tm_result.title = mdata.title;\n\t\t\t\tm_result.version = mdata.version;\n\t\t\t\tcallback(m_result);\n\t\t\t} catch (e) {\n\t\t\t\tm_result.errors = true;\n\t\t\t\tm_result.error = \"UP-ER:\" + e.message;\n\t\t\t\tcallback(m_result);\n\t\t\t}\n\n\t\t});\n\n\t},\n\n\tshouldUpdate: function(versionCurrent, versionRemote) {\n\t\tif (versionRemote.major > versionCurrent.major) {\n\t\t\treturn true;\n\t\t}\n\t\tif ((versionRemote.minor > versionCurrent.minor) && (versionRemote.major >= versionCurrent.major)) {\n\t\t\treturn true;\n\t\t}\n\t\tif ((versionRemote.patch > versionCurrent.patch) && (versionRemote.major >= versionCurrent.major) && (versionRemote.minor >= versionCurrent.minor)) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\n\tdestroy: function() {\n\t\tthis.running = false;\n\t}\n\n});\n","file":"found","server":"up","errors":false,"css":"#xkit-updating-indicator {\n\tposition: fixed;\n\ttop: 10px; left: 10px;\n\tbackground: rgba(0,0,0,0.22) no-repeat 5px 50% url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QUI1QzFEQjdENjg5MTFFMkEzMDdEMENERTdFNEZBNEYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QUI1QzFEQjhENjg5MTFFMkEzMDdEMENERTdFNEZBNEYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpBQjVDMURCNUQ2ODkxMUUyQTMwN0QwQ0RFN0U0RkE0RiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBQjVDMURCNkQ2ODkxMUUyQTMwN0QwQ0RFN0U0RkE0RiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pno+M+4AAAD2SURBVHjanFIxCsJAEMwJtskL7hfp7f1EwGfkDYLvSJHGWrDT0sMqjRCwSRdQSZFA4k6yd1zOKMGFyS07M9lj90TXdd4/scBHCGFAERGOhJKBPHI0nqc70hkQLt33ABcYjza2batsVVmWN8CuQTMyEiJbUNf1K47jDYDc6RwZY1VVJ5tJ03RLP/YB5DbH2sHYNM1TE1mWHcggrQHKPM/PmmftYJy4jtmRW2ftsA4MYe7+tLY3KqX2c41Gy7eS7uingrvJ0R7DMFz/MoOD5uMBUCwJqyRJdkVRXDEEADlq4FjTe4T7yOktSl6Hz6UH4U66u617CzAAsTaRsb/W8BoAAAAASUVORK5CYII=');\n\twidth: auto; height: 20px;\n\tline-height: 20px;\n\tpadding-left: 24px;\n\tpadding-right: 8px;\n\tcolor: white;\n\ttext-shadow: 0px 1px 0px rgba(0,0,0,0.12);\n\tfont-size: 11px;\n\tborder-radius: 20px;\n\topacity: 0.7;\n}\n\n#xkit-updating-indicator:hover {\n\topacity: 1;\n}","title":"XKit Updates","description":"Provides automatic updating of extensions","developer":"new-xkit","version":"2.1.1","frame":"false","beta":"false","slow":"false"}