{"id":"outbox","script":"//* TITLE Outbox **//\n//* VERSION 0.11.2 **//\n//* DESCRIPTION Saves your sent replies and asks. **//\n//* DETAILS This extension stores and lets you view the last 50 asks you've answered privately. Please keep in mind that this is a highly experimental extension, so if you hit a bug, please send the XKit blog an ask with the problem you've found. **//\n//* DEVELOPER STUDIOXENIX **//\n//* FRAME false **//\n//* BETA false **//\n\nXKit.extensions.outbox = new Object({\n\n\trunning: false,\n\n\tpreferences: {\n\t\t\"sep0\": {\n\t\t\ttext: \"User interface options\",\n\t\t\ttype: \"separator\"\n\t\t},\n\t\t\"show_checkbox\": {\n\t\t\ttext: \"Show 'Save to Outbox' checkbox in Inbox\",\n\t\t\tdefault: true,\n\t\t\tvalue: true\n\t\t},\n\t\t\"sep1\": {\n\t\t\ttext: \"Storage options\",\n\t\t\ttype: \"separator\"\n\t\t},\n\t\t\"use_shared\": {\n\t\t\ttext: \"Use Shared Storage (turn on if outbox messages are disappearing)\",\n\t\t\tdefault: true,\n\t\t\tvalue: true\n\t\t},\n\t},\n\n\tframe_run: function() {\n\n\t\tconsole.log(\"Outbox working on Frame mode...\");\n\t\tif (document.location.href.indexOf('/ask_form') !== -1) {\n\t\t\tthis.run_ask_frame();\n\t\t}\n\n\t},\n\n\trun_ask_frame: function() {\n\n\t\tvar form_key = $(\"#form_key\").val();\n\t\tif (typeof form_key === \"undefined\") { return; }\n\n\t\t$(document).on(\"click\", \"#ask_button\", function() {\n\n\t\t\tvar m_messages = XKit.storage.get(\"outbox\", \"messages_\" + form_key, \"\");\n\t\t\tif (XKit.extensions.outbox.preferences.use_shared.value) {\n\t\t\t\tm_messages = XKit.storage.get(\"outbox\", \"messages\", \"\");\n\t\t\t}\n\n\t\t\tvar m_messages_array = \"\";\n\n\t\t\ttry {\n\t\t\t\tm_messages_array = JSON.parse(m_messages);\n\t\t\t\tif (m_messages_array.length >= 50) {\n\t\t\t\t\t// remove the last element.\n\t\t\t\t\tm_messages_array.pop();\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tm_messages_array = [];\n\t\t\t}\n\n\t\t\tvar m_username = document.location.href.substring(document.location.href.indexOf('/ask_form') + 10);\n\t\t\tm_username = m_username.substring(0, m_username.indexOf(\".\"));\n\n\t\t\tvar m_obj = {};\n\t\t\tm_obj.avatar = \"ask\";\n\t\t\tm_obj.username = $(\"#tumblelog_name\").find(\".name\").html();\n\t\t\tm_obj.message = $(\"#question\").val();\n\t\t\tm_obj.answer = \"\";\n\t\t\tm_obj.to = m_username;\n\t\t\tm_obj.time = new Date().getTime();\n\n\t\t\tm_messages_array.unshift(m_obj);\n\t\t\t//XKit.storage.set(\"outbox\", \"messages_\" + form_key, JSON.stringify(m_messages_array));\n\t\t\tif (XKit.extensions.outbox.preferences.use_shared.value) {\n\t\t\t\tXKit.storage.set(\"outbox\", \"messages\", JSON.stringify(m_messages_array));\n\t\t\t} else {\n\t\t\t\tXKit.storage.set(\"outbox\", \"messages_\" + form_key, JSON.stringify(m_messages_array));\n\t\t\t}\n\n\n\t\t});\n\n\t},\n\n\tcheck_indash_asks: function() {\n\n\t\tvar form_key = XKit.interface.form_key();\n\n\t\t$(document).on(\"click\", \".post-form--asks .ask-button\", function() {\n\n\t\t\tvar $form = $(this).closest('.post-form--asks');\n\n\t\t\tvar m_messages = XKit.storage.get(\"outbox\", \"messages_\" + form_key, \"\");\n\t\t\tif (XKit.extensions.outbox.preferences.use_shared.value) {\n\t\t\t\tm_messages = XKit.storage.get(\"outbox\", \"messages\", \"\");\n\t\t\t}\n\n\t\t\tvar m_messages_array = \"\";\n\n\t\t\ttry {\n\t\t\t\tm_messages_array = JSON.parse(m_messages);\n\t\t\t\tif (m_messages_array.length >= 50) {\n\t\t\t\t\t// remove the last element.\n\t\t\t\t\tm_messages_array.pop();\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tm_messages_array = [];\n\t\t\t}\n\n\t\t\tvar m_obj = {};\n\t\t\tm_obj.avatar = \"ask\";\n\t\t\tm_obj.username = $form.find('.ask-from .tumblelog_name').text();\n\t\t\tm_obj.message = $form.find('textarea[name=question]').val();\n\t\t\tm_obj.answer = \"\";\n\t\t\tm_obj.to = $form.find(\".ask-recipient-label\").text();\n\t\t\tm_obj.time = new Date().getTime();\n\n\t\t\tm_messages_array.unshift(m_obj);\n\t\t\tif (XKit.extensions.outbox.preferences.use_shared.value) {\n\t\t\t\tXKit.storage.set(\"outbox\", \"messages\", JSON.stringify(m_messages_array));\n\t\t\t} else {\n\t\t\t\tXKit.storage.set(\"outbox\", \"messages_\" + form_key, JSON.stringify(m_messages_array));\n\t\t\t}\n\n\n\t\t});\n\n\t},\n\n\trun: function() {\n\t\tthis.running = true;\n\n\t\tXKit.extensions.outbox.check_indash_asks();\n\n\t\tif (XKit.interface.where().inbox !== true) {\n\t\t\tconsole.log(\"Outbox -> Quitting, not in inbox\");\n\t\t\treturn;\n\t\t}\n\n\t\tXKit.tools.init_css(\"outbox\");\n\n\t\tvar xf_html = '<ul class=\"controls_section\" id=\"xkit_outbox_ul\"><li class=\"section_header selected\">OUTGOING</li>' +\n\t\t\t'<li class=\"\" style=\"height: 36px;\"><a href=\"#\" id=\"xkit-outbox-button\">' +\n\t\t\t\t'<div class=\"hide_overflow\" style=\"color: rgba(255, 255, 255, 0.5) !important; font-weight: bold; padding-left: 10px; padding-top: 8px;\">My Outbox</div>' +\n\t\t\t'</a></li></ul>';\n\t\t$(\".controls_section:last\").before(xf_html);\n\n\t\t$(\".controls_section.inbox\").prepend(\"<li class=\\\"section_header selected\\\">INCOMING</li>\");\n\n\t\t$(\"#xkit-outbox-button\").click(function() {\n\n\t\t\tif (!$(this).parent().hasClass(\"xkit-selected\")) {\n\n\t\t\t\t$(this).parent().addClass(\"xkit-selected\");\n\t\t\t\t$(this).parent().addClass(\"selected\");\n\t\t\t\tXKit.extensions.outbox.start();\n\n\t\t\t} else {\n\n\t\t\t\t$(this).parent().removeClass(\"xkit-selected\");\n\t\t\t\t$(this).parent().removeClass(\"selected\");\n\t\t\t\tXKit.extensions.outbox.end();\n\n\t\t\t}\n\n\t\t\treturn false;\n\t\t});\n\n\t\tvar form_key = $('meta[name=tumblr-form-key]').attr(\"content\");\n\t\tif (form_key === \"\" || typeof form_key === \"undefined\") {\n\t\t\tXKit.notifications.add(\"Can't load Outbox, data-form-key not defined.\", \"error\");\n\t\t\treturn;\n\t\t}\n\n\t\tXKit.post_listener.add(\"outbox_init\", XKit.extensions.outbox.init_outbox_buttons);\n\t\tXKit.extensions.outbox.init_outbox_buttons();\n\n\t\t$(document).on('click', '.xkit-outbox-save-checkbox', function() {\n\t\t\t$(this).toggleClass(\"selected\");\n\t\t});\n\n\t},\n\n\tinit_outbox_buttons: function() {\n\n\t\t$(\"[id^='ask_answer_link_']\").unbind(\"click\", XKit.extensions.outbox.save_activate);\n\t\t$(\"[id^='ask_answer_link_']\").bind(\"click\", XKit.extensions.outbox.save_activate);\n\n\t},\n\n\tsave_activate: function(e) {\n\n\t\tvar obj = e.target || e.srcElement;\n\t\tvar m_parent = $(obj).parentsUntil(\".post\").parent();\n\t\tvar private_button = $(m_parent).find('[id^=\"private_answer_button_\"]');\n\n\t\tif ($(m_parent).hasClass(\"xkit-outbox-activated\") === true) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (XKit.extensions.outbox.preferences.show_checkbox.value) {\n\t\t\t$(m_parent).find(\".chrome.ask_cancel_button\").before(\"<div style=\\\"padding-top: 5px; margin-bottom: 10px;\\\"><div class=\\\"xkit-checkbox xkit-outbox-save-checkbox selected\\\"><b>&nbsp</b>Save to outbox if answered privately</div></div>\");\n\t\t}\n\n\t\t$(m_parent).addClass(\"xkit-outbox-activated\");\n\t\t$(private_button).bind(\"click\", XKit.extensions.outbox.save);\n\n\t},\n\n\tsave: function(e) {\n\n\t\tvar obj = e.target || e.srcElement;\n\n\t\tvar m_parent = $(obj).parentsUntil(\".post\").parent();\n\n\t\tif ($(m_parent).find(\".xkit-outbox-save-checkbox\").length > 0) {\n\n\t\t\tif (!$(m_parent).find(\".xkit-outbox-save-checkbox\").hasClass(\"selected\")) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t}\n\n\t\tvar m_avatar = $(m_parent).find(\".post_avatar_image\").attr('src');\n\t\tvar m_username = $(m_parent).find(\".post_info\").find(\"a\").html();\n\t\tvar m_message = $(m_parent).find(\".post_body\").html();\n\t\tvar m_to = $(m_parent).attr('data-tumblelog-name');\n\n\t\tvar post_id = $(m_parent).attr('data-post-id');\n\t\tXKit.extensions.outbox.poke_tinymce(post_id);\n\n\t\tif (m_message.indexOf(\"<div id=\\\"ask_answer_\") !== -1) {\n\n\t\t\tm_message = m_message.substring(0, m_message.indexOf(\"<div\"));\n\n\t\t}\n\n\t\tvar m_answer = $('#ask_answer_field_' + post_id).val();\n\n\t\tsetTimeout(function() {\n\n\t\t\tm_answer = $('#ask_answer_field_' + post_id).val();\n\n\t\t\tvar form_key = $('meta[name=tumblr-form-key]').attr(\"content\");\n\t\t\tvar m_messages = XKit.storage.get(\"outbox\", \"messages_\" + form_key, \"\");\n\t\t\tif (XKit.extensions.outbox.preferences.use_shared.value) {\n\t\t\t\tm_messages = XKit.storage.get(\"outbox\", \"messages\", \"\");\n\t\t\t}\n\n\t\t\tvar m_messages_array = \"\";\n\n\t\t\ttry {\n\t\t\t\tm_messages_array = JSON.parse(m_messages);\n\t\t\t\tif (m_messages_array.length >= 50) {\n\t\t\t\t\t// remove the last element.\n\t\t\t\t\tm_messages_array.pop();\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tm_messages_array = [];\n\t\t\t}\n\n\t\t\tvar m_obj = {};\n\t\t\tm_obj.avatar = m_avatar;\n\t\t\tm_obj.username = m_username;\n\t\t\tm_obj.message = m_message;\n\t\t\tm_obj.answer = m_answer;\n\t\t\tm_obj.to = m_to;\n\t\t\tm_obj.time = new Date().getTime();\n\n\t\t\tm_messages_array.unshift(m_obj);\n\n\t\t\tif (XKit.extensions.outbox.preferences.use_shared.value) {\n\t\t\t\tXKit.storage.set(\"outbox\", \"messages\", JSON.stringify(m_messages_array));\n\t\t\t} else {\n\t\t\t\tXKit.storage.set(\"outbox\", \"messages_\" + form_key, JSON.stringify(m_messages_array));\n\t\t\t}\n\t\t\tXKit.notifications.add(\"Saved to outbox.\", \"ok\");\n\n\t\t}, 1);\n\n\t},\n\n\tpoke_tinymce: function(post_id) {\n\t\tvar source = \" if (tinyMCE && tinyMCE.get('ask_answer_field_\" + post_id + \"')) {  \" +\n\t\t\t\t\t\t\" document.getElementById('ask_answer_field_\" + post_id + \"').value = (tinyMCE.get('ask_answer_field_\" + post_id + \"').getContent()); \" +\n\t\t\t\t \" } \";\n\n\t\tif ('function' == typeof source) {\n\t\t\tsource = '(' + source + ')();';\n\t\t}\n\n\t\tvar script = document.createElement('script');\n\t\tscript.setAttribute(\"type\", \"application/javascript\");\n\t\tscript.textContent = source;\n\t\tdocument.body.appendChild(script);\n\t},\n\n\tstart: function() {\n\n\t\tXKit.tools.add_css(\" .post { display: none; } .post.by-xkit-outbox { display: block !important; } #auto_pagination_loader, #next_page_link { display: none !important; } \", \"outbox_additional\");\n\n\t\tvar form_key = $('meta[name=tumblr-form-key]').attr(\"content\");\n\t\tif (form_key === \"\" || typeof form_key === \"undefined\") {\n\t\t\tXKit.extensions.outbox.show_empty(\"Can't load messages,<br/>data-form-key not found.\");\n\t\t\treturn;\n\t\t}\n\n\t\tvar m_messages = XKit.storage.get(\"outbox\", \"messages_\" + form_key, \"\");\n\t\tif (XKit.extensions.outbox.preferences.use_shared.value) {\n\t\t\tm_messages = XKit.storage.get(\"outbox\", \"messages\", \"\");\n\t\t}\n\n\t\tif (m_messages === \"\") {\n\t\t\tXKit.extensions.outbox.show_empty();\n\t\t\treturn;\n\t\t}\n\n\t\tvar messages_array;\n\t\ttry {\n\t\t\tmessages_array = JSON.parse(m_messages);\n\t\t\tXKit.extensions.outbox.show(messages_array);\n\t\t\t$(document).on('click', '.xkit-outbox-delete', XKit.extensions.outbox.delete);\n\t\t} catch (e) {\n\t\t\tXKit.extensions.outbox.show_empty(\"Can't load messages,<br/>\" + e.message);\n\t\t}\n\n\t},\n\n\tdelete: function(e) {\n\n\t\tvar obj = e.target;\n\n\t\tvar form_key = $('meta[name=tumblr-form-key]').attr(\"content\");\n\t\tvar m_messages = XKit.storage.get(\"outbox\", \"messages_\" + form_key, \"\");\n\t\tif (XKit.extensions.outbox.preferences.use_shared.value) {\n\t\t\tm_messages = XKit.storage.get(\"outbox\", \"messages\", \"\");\n\t\t}\n\n\t\tvar m_messages_array = [];\n\n\t\ttry {\n\t\t\tm_messages_array = JSON.parse(m_messages);\n\t\t} catch (err) {\n\t\t}\n\n\t\tm_messages_array.splice(parseInt($(obj).attr('data-outbox-id')), 1);\n\n\t\tif (XKit.extensions.outbox.preferences.use_shared.value) {\n\t\t\tXKit.storage.set(\"outbox\", \"messages\", JSON.stringify(m_messages_array));\n\t\t} else {\n\t\t\tXKit.storage.set(\"outbox\", \"messages_\" + form_key, JSON.stringify(m_messages_array));\n\t\t}\n\t\t// XKit.storage.set(\"outbox\", \"messages_\" + form_key, JSON.stringify(m_messages_array));\n\n\t\tvar parent = $(obj).parentsUntil('#posts');\n\t\t$(parent).fadeOut('slow', function() {\n\t\t\t$(parent).remove();\n\t\t});\n\n\n\n\t},\n\n\tshow: function(m_array) {\n\n\t\tvar m_html = \"\";\n\t\tfor (var m_message in m_array) {\n\n\t\t\tvar m_obj = m_array[m_message];\n\n\t\t\tm_html = m_html + XKit.extensions.outbox.render(m_obj, m_message);\n\n\t\t}\n\t\tif ($('.no_posts_found').length > 0) {\n\t\t\t$('.no_posts_found').after(\"<ol id='posts' class='posts post-avatar--static'></ol>\");\n\t\t\t$('.no_posts_found').hide();\n\t\t}\n\t\t$(\"#posts\").prepend(m_html);\n\n\t},\n\n\trender_ask: function(obj, m_id) {\n\n\t\tvar to_return = \"<li class=\\\"post_container\\\"><div class=\\\"post is_note note is_mine post_full by-xkit-outbox is_mine is_original is_private_answer no_source\\\">\";\n\n\t\tvar m_link = \"<a class=\\\"xkit-outbox-link\\\" href=\\\"http://\" + obj.to + \".tumblr.com/\\\">\" + obj.to + \"</a>\";\n\n\t\tvar m_day = \"\";\n\t\tvar m_date = \"\";\n\n\t\tif (obj.time !== \"\" && typeof obj.time !== \"undefined\") {\n\t\t\t// defined in moment.js\n\t\t\t/* globals moment */\n\t\t\tvar moment_val = moment(obj.time);\n\t\t\tm_day = moment_val.format('ddd');\n\t\t\tm_date = moment_val.format('MM/DD/YY hh:mm a');\n\t\t} else {\n\t\t\tm_day = \"?\";\n\t\t\tm_date = \"Unknown\";\n\t\t}\n\n\t\tobj.message = $(\"<div>\" + obj.message + \"</div>\").text();\n\n\t\tto_return = to_return + \"<div class=\\\"post_avatar\\\"><div class=\\\"queue\\\">\" +\n\t\t\t\t\"<div class=\\\"publish_info day publish_on_day\\\">\" + m_day + \"</div>\" +\n\t\t\t\t\"<div class=\\\"publish_info time publish_on_time\\\">\" + m_date + \"</div>\" +\n\t\t\t\"</div></div>\";\n\n\t\tto_return = to_return + \"<div class=\\\"post-wrapper\\\">\" +\n\t\t\t\t\"<span class=\\\"xkit-outbox-fanmail-indicator\\\">sent ask</span>\" +\n\t\t\t\t\"<div class=\\\"post_header\\\"><div class=\\\"post_info\\\">You've sent to \" + m_link + \"</div></div>\" +\n\t\t\t\t\"<div class=\\\"post_content clearfix\\\"><div class=\\\"post_content_inner clearfix\\\">\" +\n\t\t\t\t\t\"<div class=\\\"post_body\\\">\" +\n\t\t\t\t\t\t\"<div class=\\\"clear\\\">&nbsp;</div>\" +\n\t\t\t\t\t\t\"<div class=\\\"post_question_fan_mail\\\">\" + obj.message + \"</div>\" +\n\t\t\t\t\t\"</div>\" +\n\t\t\t\t\"</div></div>\" +\n\t\t\t\t\"<div class=\\\"post_footer clearfix\\\">\" +\n\t\t\t\t\t\"<div class=\\\"post_notes\\\"><div class=\\\"post_notes_inner\\\"></div></div>\" +\n\t\t\t\t\t\"<div class=\\\"post_controls\\\" role=\\\"toolbar\\\"><div class=\\\"post_controls_inner\\\">\" +\n\t\t\t\t\t\t\"<div class=\\\"post_control deny-xoutbox xkit-outbox-delete\\\" data-outbox-id=\\\"\" + m_id + \"\\\" title=\\\"Delete\\\"></div>\" +\n\t\t\t\t\t\"</div></div>\" +\n\t\t\t\t\"</div>\" +\n\t\t\t\"</div>\";\n\n\t\tto_return = to_return + \"</div></li>\";\n\n\t\treturn to_return;\n\n\t},\n\n\trender_fan_mail: function(obj, m_id) {\n\n\t\tvar to_return = \"<li class=\\\"post_container\\\"><div class=\\\"post is_note note is_mine post_full by-xkit-outbox is_mine is_original is_private_answer no_source\\\">\";\n\n\t\tvar m_link = \"<a class=\\\"xkit-outbox-link\\\" href=\\\"http://\" + obj.to + \".tumblr.com/\\\">\" + obj.to + \"</a>\";\n\n\t\tvar m_day = \"\";\n\t\tvar m_date = \"\";\n\n\t\tif (obj.time !== \"\" && typeof obj.time !== \"undefined\") {\n\t\t\tvar moment_val = moment(obj.time);\n\t\t\tm_day = moment_val.format('ddd');\n\t\t\tm_date = moment_val.format('MM/DD/YY hh:mm a');\n\t\t} else {\n\t\t\tm_day = \"?\";\n\t\t\tm_date = \"Unknown\";\n\t\t}\n\n\t\tobj.message = $(\"<div>\" + obj.message + \"</div>\").text();\n\n\t\tto_return = to_return + \"<div class=\\\"post_avatar\\\"><div class=\\\"queue\\\">\" +\n\t\t\t\t\"<div class=\\\"publish_info day publish_on_day\\\">\" + m_day + \"</div>\" +\n\t\t\t\t\"<div class=\\\"publish_info time publish_on_time\\\">\" + m_date + \"</div>\" +\n\t\t\t\"</div></div>\";\n\n\t\tto_return = to_return + \"<div class=\\\"post-wrapper\\\">\" +\n\t\t\t\t\"<span class=\\\"xkit-outbox-fanmail-indicator\\\">fan mail</span>\" +\n\t\t\t\t\"<div class=\\\"post_header\\\"><div class=\\\"post_info\\\">You've sent to \" + m_link + \"</div></div>\" +\n\t\t\t\t\"<div class=\\\"post_content clearfix\\\"><div class=\\\"post_content_inner clearfix\\\">\" +\n\t\t\t\t\t\"<div class=\\\"post_body\\\">\" +\n\t\t\t\t\t\t\"<div class=\\\"clear\\\">&nbsp;</div>\" +\n\t\t\t\t\t\t\"<div class=\\\"post_question_fan_mail\\\">\" + obj.message + \"</div>\" +\n\t\t\t\t\t\"</div>\" +\n\t\t\t\t\"</div></div>\" +\n\t\t\t\t\"<div class=\\\"post_footer clearfix\\\">\" +\n\t\t\t\t\t\"<div class=\\\"post_notes\\\"><div class=\\\"post_notes_inner\\\"></div></div>\" +\n\t\t\t\t\t\"<div class=\\\"post_controls\\\" role=\\\"toolbar\\\"><div class=\\\"post_controls_inner\\\">\" +\n\t\t\t\t\t\t\"<div class=\\\"post_control deny-xoutbox xkit-outbox-delete\\\" data-outbox-id=\\\"\" + m_id + \"\\\" title=\\\"Delete\\\"></div>\" +\n\t\t\t\t\t\"</div></div>\" +\n\t\t\t\t\"</div>\" +\n\t\t\t\"</div>\";\n\n\t\tto_return = to_return + \"</div></li>\";\n\n\t\treturn to_return;\n\n\t},\n\n\trender: function(obj, m_id) {\n\n\t\tif (obj.avatar === \"fan_mail\") {\n\t\t\treturn XKit.extensions.outbox.render_fan_mail(obj, m_id);\n\t\t}\n\n\t\tif (obj.avatar === \"ask\") {\n\t\t\treturn XKit.extensions.outbox.render_ask(obj, m_id);\n\t\t}\n\n\t\tvar to_return = \"<li class=\\\"post_container\\\"><div class=\\\"post is_note note is_mine post_full by-xkit-outbox is_mine is_original is_private_answer no_source\\\">\";\n\n\t\tvar m_link = \"<a class=\\\"xkit-outbox-link\\\" href=\\\"http://\" + obj.username + \".tumblr.com/\\\">\" + obj.username + \"</a>\";\n\n\t\tvar av_link = \"<a href=\\\"http://\" + obj.username + \".tumblr.com/\\\"><img width=\\\"24\\\" height=\\\"24\\\" src=\\\"\" + obj.avatar + \"\\\"></a>\";\n\t\tvar av_text = \"<a href=\\\"http://\" + obj.username + \".tumblr.com/\\\" class=\\\"post_question_asker\\\">\" + obj.username + \"</a>\";\n\n\t\tvar m_day = \"\";\n\t\tvar m_date = \"\";\n\n\t\tif (obj.time !== \"\" && typeof obj.time !== \"undefined\") {\n\t\t\tvar moment_val = moment(obj.time);\n\t\t\tm_day = moment_val.format('ddd');\n\t\t\tm_date = moment_val.format('MM/DD/YY hh:mm a');\n\t\t} else {\n\t\t\tm_day = \"?\";\n\t\t\tm_date = \"Unknown\";\n\t\t}\n\n\t\tto_return = to_return + \"<div class=\\\"post_avatar\\\"><div class=\\\"queue\\\">\" +\n\t\t\t\t\"<div class=\\\"publish_info day publish_on_day\\\">\" + m_day + \"</div>\" +\n\t\t\t\t\"<div class=\\\"publish_info time publish_on_time\\\">\" + m_date + \"</div>\" +\n\t\t\t\"</div></div>\";\n\n\t\tif (obj.message.indexOf(\"<div\") !== -1) {\n\t\t\tobj.message = obj.message.substring(0, obj.message.indexOf(\"<div\"));\n\t\t}\n\n\t\tto_return = to_return + \"<div class=\\\"post-wrapper\\\">\" +\n\t\t\t\t\"<div class=\\\"post_header\\\"><div class=\\\"post_info\\\">You've sent to \" + m_link + \"</div></div>\" +\n\t\t\t\t\"<div class=\\\"post_content clearfix\\\"><div class=\\\"post_content_inner clearfix\\\">\" +\n\t\t\t\t\t\"<div class=\\\"post_body\\\">\" +\n\t\t\t\t\t\t\"<div class=\\\"clear\\\">&nbsp;</div>\" +\n\t\t\t\t\t\t\"<div class=\\\"post_question\\\">\" + obj.message + \"</div>\" +\n\t\t\t\t\t\t\"<div class=\\\"asking_avatar\\\">\" +\n\t\t\t\t\t\t\tav_link +\n\t\t\t\t\t\t\tav_text +\n\t\t\t\t\t\t\"</div>\" +\n\t\t\t\t\t\t\"<div class=\\\"post_answer_bar\\\" style=\\\"margin-top: 15px; padding-top: 15px; border-top: 1px solid #e7eaec\\\">\" + obj.answer + \"</div>\" +\n\t\t\t\t\t\"</div>\" +\n\t\t\t\t\"</div></div>\" +\n\t\t\t\t\"<div class=\\\"post_footer clearfix\\\">\" +\n\t\t\t\t\t\"<div class=\\\"post_notes\\\"><div class=\\\"post_notes_inner\\\"></div></div>\" +\n\t\t\t\t\t\"<div class=\\\"post_controls\\\" role=\\\"toolbar\\\"><div class=\\\"post_controls_inner\\\">\" +\n\t\t\t\t\t\t\"<div class=\\\"post_control deny-xoutbox xkit-outbox-delete\\\" data-outbox-id=\\\"\" + m_id + \"\\\" title=\\\"Delete\\\"></div>\" +\n\t\t\t\t\t\"</div></div>\" +\n\t\t\t\t\"</div>\" +\n\t\t\t\"</div>\";\n\n\t\tto_return = to_return + \"</div></li>\";\n\n\t\treturn to_return;\n\n\t},\n\n\tshow_empty: function(m_message) {\n\n\t\tvar m_error = \"No messages on outbox yet.\";\n\t\tif (typeof m_message !== \"undefined\" && m_message !== \"\") {\n\t\t\tm_error = m_message;\n\t\t}\n\n\t\t$(\".no_posts_found\").remove();\n\t\t$(\"#posts\").before(\n\t\t\t\"<div id=\\\"xkit-outbox-no-posts\\\" class=\\\"no_posts_found\\\" style=\\\"padding-top: 234px; padding-bottom: 234px;\\\">\" +\n\t\t\t\t\"<i class=\\\"icon_mail\\\"></i>\" +\n\t\t\t\tm_error  +\n\t\t\t\"</div>\"\n\t\t);\n\n\t},\n\n\tend: function() {\n\n\t\t$(\".by-xkit-outbox\").parent().remove();\n\t\t$(\"#xkit-outbox-no-posts\").remove();\n\t\tif ($('.no_posts_found').length > 0) {\n\t\t\t$('.no_posts_found').show();\n\t\t\t$('#posts').remove();\n\t\t}\n\t\tXKit.tools.remove_css(\"outbox_additional\");\n\t\t$(document).off('click', '.xkit-outbox-delete', XKit.extensions.outbox.delete);\n\n\t},\n\n\tdestroy: function() {\n\t\tthis.running = false;\n\t\tXKit.extensions.outbox.end();\n\t\t$(\"[id^='ask_answer_link_']\").off(\"click\", XKit.extensions.outbox.save_activate);\n\t\tXKit.post_listener.remove(\"outbox_init\");\n\t}\n\n});\n","file":"found","server":"up","errors":false,"icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MDVFREE3NzNERUE0MTFFMjk3RDJBOUJGM0YwNzNFMEIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MDVFREE3NzRERUE0MTFFMjk3RDJBOUJGM0YwNzNFMEIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowNUVEQTc3MURFQTQxMUUyOTdEMkE5QkYzRjA3M0UwQiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDowNUVEQTc3MkRFQTQxMUUyOTdEMkE5QkYzRjA3M0UwQiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsarvEkAAAb1SURBVHjalJbNy25l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","css":"#xkit-outbox-button:after {\n\n\tbackground-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MDRBQkU4RUYzNkU2MTFFM0E0MTFDNDE2OTFDMzA4QzciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MDRBQkU4RjAzNkU2MTFFM0E0MTFDNDE2OTFDMzA4QzciPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowNEFCRThFRDM2RTYxMUUzQTQxMUM0MTY5MUMzMDhDNyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDowNEFCRThFRTM2RTYxMUUzQTQxMUM0MTY5MUMzMDhDNyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pm+UtRMAAACLSURBVHjaYvz//z8DNQETkeo+AbEjMQoZiXDhVSDWgqmn1IUBSIaBwA+CTgS5EA/GBg7j04PPhb9xiNtAXU5SGF5F8ypWvcSGYRIRhoHAL2LD8N9/4sFkdP0sBFz9n1ivkpqwqZ5TSDbwPw7vEQNQ9FLdhSzkpDW6hiELlvAYXLHMQm5Y0c2FAAEGABUCn58LCOv2AAAAAElFTkSuQmCC') !important;\n\tbackground-position: 0px 7px !important;\n\tbackground-repeat: no-repeat !important;\n\twidth: 20px;\n\tcontent: \"A\";\n\tfont-size: 0;\n\topacity: 0.42;\n\n}\n\n.selected #xkit-outbox-button:after {\n\topacity: 1 !important;\n}\n\n.post_full .post_control.deny-xoutbox:after {\n\tbackground-position: -914px -123px;\n}\n\n.post_question_fan_mail {\n\n\tbackground: #e7eaec;\n\tpadding: 15px 20px; font-size: 22px;\n\tborder-radius: 5px;\n\tfont-weight: bold;\n\tline-height: 28px;\n\n}\n\n.xkit-outbox-fanmail-indicator {\n\n\tbackground: #e7eaec;\n\tfont-weight: bold;\n\tborder-radius: 4px;\n\tposition: absolute;\n\tbottom: 13px;\n\tleft: 20px;\n\tfont-size: 12px;\n\tpadding: 3px 8px;\n\n}","title":"Outbox","description":"Saves your sent replies and asks.","developer":"STUDIOXENIX","version":"0.11.2","details":"This extension stores and lets you view the last 50 asks you've answered privately. Please keep in mind that this is a highly experimental extension, so if you hit a bug, please send the XKit blog an ask with the problem you've found.","frame":"false","beta":"false","slow":"false"}