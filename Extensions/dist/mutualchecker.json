{"id":"mutualchecker","script":"//* TITLE Mutual Checker **//\n//* VERSION 2.0.1 **//\n//* DESCRIPTION A simple way to see who follows you back **//\n//* DETAILS Adds a small icon and '[user] follows you' hovertext to URLs you see in post headers (when appropriate).<br><br>Only checks the URL when the person directly made/reblogged/submitted/published the post, and doesn't work on sideblogs. **//\n//* DEVELOPER New-XKit **//\n//* FRAME false **//\n//* BETA false **//\n\nXKit.extensions.mutualchecker = new Object({\n\t\n\trunning: false,\n\tmutuals: {},\n\t\n\tpreferences: {\n\t\t\"main_blog\": {\n\t\t\ttext: \"Blog to check for follow-backs on:\",\n\t\t\tdefault: \"\",\n\t\t\tvalue: \"\",\n\t\t\ttype: \"blog\"\n\t\t},\n\t\t\"put_in_front\": {\n\t\t\ttext: \"Place mutual icon before, not after usernames\",\n\t\t\tdefault: false,\n\t\t\tvalue: false\n\t\t}\n\t},\n\n\tcpanel: function() {\n\t\t$(\"select[data-setting-id=\\\"main_blog\\\"] option\").first().remove();\n\t},\n\n\trun: function() {\n\t\tthis.running = true;\n\t\tXKit.blog_listener.add(\"mutualchecker\", this.init);\n\t},\n\n\tinit: function(blogs) {\n\t\tif ($.inArray(this.preferences.main_blog.value, blogs) === -1) {\n\t\t\tthis.preferences.main_blog.value = blogs[0];\n\t\t}\n\t\tXKit.tools.init_css(\"mutualchecker\");\n\t\tthis.add_follower_icons();\n\t\tthis.add_post_icons();\n\t\tXKit.post_listener.add(\"mutualchecker\", this.add_post_icons);\n\t},\n\n\tadd_follower_icons: function() {\n\t\tvar following = XKit.interface.where().following;\n\t\t$(\".follower\").each(function() {\n\t\t\tif (following || !$(this).find(\".follow_button\").length) {\n\t\t\t\tvar $name_div = $(this).find(\".name-link\");\n\t\t\t\tvar url = $name_div.text();\n\t\t\t\tXKit.interface.is_following(url, XKit.extensions.mutualchecker.preferences.main_blog.value).then(function(follow) {\n\t\t\t\t\tif (follow) {\n\t\t\t\t\t\tXKit.extensions.mutualchecker.add_label($name_div, url);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tadd_post_icons: function() {\n\t\t$(XKit.interface.get_posts(\"mutualchecker-done\")).each(function() {\n\t\t\tvar $post = $(this).addClass(\"mutualchecker-done\"), json_obj;\n\t\t\tif ($post.hasClass(\"is_private_answer\")) {\n\t\t\t\ttry {\n\t\t\t\t\tjson_obj = JSON.parse($post.find(\".post_avatar_link\").attr(\"data-tumblelog-popover\"));\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tXKit.extensions.mutualchecker.check(json_obj, $post.find(\".post_info_submissions\").first());\n\t\t\t} else {\n\t\t\t\t$post.find(\".post_info_link[data-tumblelog-popover]:not(.reblog_icon + .post_info_link, .tf2_icon + .post_info_link), .post-info-tumblelog > a[data-tumblelog-popover]\").each(function() {\n\t\t\t\t\tvar $link = $(this);\n\t\t\t\t\ttry {\n\t\t\t\t\t\tjson_obj = JSON.parse($link.attr(\"data-tumblelog-popover\"));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tXKit.extensions.mutualchecker.check(json_obj, $link);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tcheck: function(json_obj, $link) {\n\t\tif (json_obj.following && !json_obj.customizable) {\n\t\t\tif (typeof this.mutuals[json_obj.name] === \"undefined\") {\n\t\t\t\tXKit.interface.is_following(json_obj.name, this.preferences.main_blog.value).then(function(follow) {\n\t\t\t\t\tif (follow) {\n\t\t\t\t\t\tXKit.extensions.mutualchecker.add_label($link, json_obj.name);\n\t\t\t\t\t\tXKit.extensions.mutualchecker.mutuals[json_obj.name] = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tXKit.extensions.mutualchecker.mutuals[json_obj.name] = false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (this.mutuals[json_obj.name]) {\n\t\t\t\tthis.add_label($link, json_obj.name);\n\t\t\t}\n\t\t}\n\t},\n\n\tadd_label: function($name_div, user) {\n\t\tif ($name_div.hasClass(\"post_info_submissions\")) {\n\t\t\t$name_div.html('<span class=\"mutuals' + ( XKit.extensions.mutualchecker.preferences.put_in_front.value ? \" mutuals-front\" : \"\") + '\">' + user + '</span>' + $name_div.text().trim().substring(user.length));\n\t\t} else {\n\t\t\t$name_div.addClass(\"mutuals\").attr(\"title\", user + \" follows you\");\n\t\t\tif (XKit.extensions.mutualchecker.preferences.put_in_front.value) {\n\t\t\t\t$name_div.addClass(\"mutuals-front\");\n\t\t\t}\n\t\t}\n\t},\n\n\tdestroy: function() {\n\t\tthis.running = false;\n\t\tthis.mutuals = {};\n\t\tXKit.post_listener.remove(\"mutualchecker\");\n\t\t$(\".mutuals\").removeAttr(\"title\").removeClass(\"mutuals\").removeClass(\"mutuals-front\");\n\t\t$(\".mutualchecker-done\").removeClass(\"mutualchecker-done\");\n\t\tXKit.tools.remove_css(\"mutualchecker\");\n\t}\n});\n","file":"found","server":"up","errors":false,"icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAACGUlEQVRIS7XTzU8TQRgG8PeP62GzaW3TLxMFCR68SPDQBS4YoQYOiKCiFxMPbWH5iJAaAwmVCATx4gE8EBJNKX6gUMCP+HV1Z+fZnTrTylCyv9sz77zzpJuU/gSMfgcs+IJfAaOf9Ryvj7UbIS3nsvNYqo9+qI7ms7GQGUtpyeS2sFYffZdVn/bHQqGW0TXkM1ILXt695Pzya7kK8hnRN9m6W9AEM903u4NHBPoqe3GnFRun1zONRwT6IltzC3qmEPVsP7rqFqhbdCzjBd2TiJomu1lBnS06EvgljxFJXB4ovsXsJF4BolBbsHzvSjKZiPj/MDM9UNzD7CSNCw5lq6PuJ7IRfW9meuNutxHveLiKQ5/NC5StQ6rKVkZYQZeN6LO72BNc68gKTj18qm5V6UCGgglE38S/BTj18Km6dUD7suXbLezqOKJve/ZmW9j5Rka4re/xaxz6xnmBsrWvX/B/jQs+y56jAFGTV4Ao0Cdh+kbSEWffwWFGkxeu21uYbT4Zs9qjJhsY4fOdw3OvdjHhChYbWQVEgfYEfslnpjrvlypssFGwojj0Ra3ChrvFeQWIAn2ULQ2zT2TlER0Lg2m2LUsPLuCCI88LaraAPsie3WIFmTyiI59hyyr1Tu0J6BTomOmNNCh4LyvxghyipoZb9E5WGrroXG1KIlvEIwLtyhabLDBTHQ8W8UYNqgQs+IKdgFE5UOXyX4UwNMSHFXXQAAAAAElFTkSuQmCC","css":".mutuals::after, .mutuals::before{\n\tfont-family: tumblr-icons, None;\n\tfont-weight: normal;\n\tfont-size: 1.23em;\n\tline-height: 0;\n}\n\n.mutuals:not(.mutuals-front)::after{\n\tcontent: \"\\EA59\";\n\tpadding-left: 0.3em;\n}\n\n.mutuals.mutuals-front::before{\n\tcontent: \"\\EA59\";\n\tpadding-right: 0.3em;\n}\n","title":"Mutual Checker","description":"A simple way to see who follows you back","developer":"New-XKit","version":"2.0.1","details":"Adds a small icon and '[user] follows you' hovertext to URLs you see in post headers (when appropriate).<br><br>Only checks the URL when the person directly made/reblogged/submitted/published the post, and doesn't work on sideblogs.","frame":"false","beta":"false","slow":"false"}