{"id":"alternative_timestamps","script":"//* TITLE Alternative Timestamps **//\n//* VERSION 1.1.2 **//\n//* DESCRIPTION Adds timestamps to dashboard posts using a parsing method **//\n//* DETAILS This version of Timestamps uses parsing methods to display the timestamp instead of AJAX calls. Currently only in English. **//\n//* DEVELOPER jesskay **//\n//* FRAME false **//\n//* BETA true **//\n\n// defined in moment.js\n/* globals moment */\n\nXKit.extensions.alternative_timestamps = new Object({\n\n\trunning: false,\n\n\tdays_regex: /(Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday)/i,\n\tyear_regex: /([1-9][0-9]*)\\,/,\n\n\tpreferences: {\n\t\tformat_string: {\n\t\t\ttext: 'Format string',\n\t\t\ttype: 'text',\n\t\t\tdefault: 'YYYY-MM-DD HH:mm :: RR'\n\t\t},\n\t\tformat_syntax_header: {\n\t\t\ttext: 'Format string syntax',\n\t\t\ttype: 'separator'\n\t\t}\n\t},\n\n\trun: function() {\n\t\tthis.running = true;\n\t\tXKit.tools.init_css('alternative_timestamps');\n\n\t\tXKit.post_listener.add('alternative_timestamps_insert', this.insert_timestamps);\n\n\t\tthis.insert_timestamps();\n\t},\n\n\tinsert_timestamps: function() {\n\t\t$('#posts .post.with_permalink').add('#inboxposts .post.with_permalink').not('.alternative_timestamp_done').each(function(index) {\n\t\t\t$(this).addClass('alternative_timestamp_done');\n\n\t\t\tvar moment_timestamp = XKit.extensions.alternative_timestamps.parse_timestamp($(this));\n\n\t\t\tif (moment_timestamp !== null) {\n\t\t\t\tvar post_id = $(this).attr('id').replace('post_', '');\n\n\t\t\t\tvar $timestamp = $('<div>');\n\t\t\t\t$timestamp.attr('id', 'alternative_timestamp_' + post_id);\n\t\t\t\t$timestamp.addClass('alternative_timestamp');\n\t\t\t\t$timestamp.text(XKit.extensions.alternative_timestamps.render_timestamp(moment_timestamp));\n\n\t\t\t\t$(this).find('.post_info').first().append($timestamp);\n\t\t\t}\n\t\t});\n\t},\n\n\tremove_timestamps: function() {\n\t\t$('.alternative_timestamp_done').removeClass('alternative_timestamp_done');\n\t\t$('.alternative_timestamp').remove();\n\t},\n\n\tstrip_ordinals: function(date_string) {\n\t\treturn date_string.replace(/([0-9])(?:st|nd|rd|th)/i, \"$1\");\n\t},\n\n\tparse_timestamp: function($post) {\n\t\tvar permalink_title = $post.find('.post_permalink').attr('title');\n\t\tif (permalink_title.indexOf('-') < 0) { return null; }\n\n\t\tvar permalink_time = permalink_title.slice(permalink_title.indexOf('-') + 2);\n\t\tvar permalink_time_without_ordinals = this.strip_ordinals(permalink_time);\n\n\t\tvar moment_post_time = moment(); // wrong, but next it's refined\n\n\t\tif (permalink_time.match(this.days_regex) !== null) {\n\t\t\t// \"{day of week}, {time}\"\n\n\t\t\tvar day_name = permalink_time.match(this.days_regex)[1];\n\t\t\tvar permalink_time_without_days = permalink_time.replace(this.days_regex, \"\");\n\t\t\tvar moment_permalink_time_without_days = moment(permalink_time_without_days, 'h:mma');\n\n\t\t\tmoment_post_time.hours(moment_permalink_time_without_days.hours());\n\t\t\tmoment_post_time.minutes(moment_permalink_time_without_days.minutes());\n\n\t\t\twhile (moment_post_time.format(\"dddd\") !== day_name) {\n\t\t\t\tmoment_post_time.subtract(moment.duration(1, 'days'));\n\t\t\t}\n\t\t} else if (permalink_time.match(',') === null) {\n\t\t\t// \"{time}\"\n\n\t\t\tvar moment_permalink_time_hmma = moment(permalink_time, 'h:mma');\n\n\t\t\tmoment_post_time.hours(moment_permalink_time_hmma.hours());\n\t\t\tmoment_post_time.minutes(moment_permalink_time_hmma.minutes());\n\t\t} else if (permalink_time.match(this.year_regex) === null) {\n\t\t\t// \"{month} {day}{ordinal}, {time}\"\n\n\t\t\tvar moment_permalink_time_without_ordinals = moment(permalink_time_without_ordinals, 'MMM D, h:mma');\n\n\t\t\tmoment_post_time.month(moment_permalink_time_without_ordinals.month());\n\t\t\tmoment_post_time.date(moment_permalink_time_without_ordinals.date());\n\t\t\tmoment_post_time.hours(moment_permalink_time_without_ordinals.hours());\n\t\t\tmoment_post_time.minutes(moment_permalink_time_without_ordinals.minutes());\n\t\t} else {\n\t\t\t// \"{month} {day}{ordinal} {year}, {time}\"\n\n\t\t\tvar moment_permalink_time_with_year = moment(permalink_time_without_ordinals, 'MMM D YYYY, h:mma');\n\n\t\t\tmoment_post_time.year(moment_permalink_time_with_year.year());\n\t\t\tmoment_post_time.month(moment_permalink_time_with_year.month());\n\t\t\tmoment_post_time.date(moment_permalink_time_with_year.date());\n\t\t\tmoment_post_time.hours(moment_permalink_time_with_year.hours());\n\t\t\tmoment_post_time.minutes(moment_permalink_time_with_year.minutes());\n\t\t}\n\n\t\treturn moment_post_time;\n\t},\n\n\trender_timestamp: function(moment_timestamp, format_string) {\n\t\tformat_string = format_string || this.preferences.format_string.value;\n\n\t\tformat_string = format_string.replace(/\\[(.*)\\]/g, this.escape_raw);\n\t\tformat_string = format_string.replace(/RR/g, this.escape_raw(null, moment_timestamp.fromNow()));\n\n\t\treturn moment_timestamp.format(format_string);\n\t},\n\n\tescape_raw: function(full_match, raw_block) {\n\t\treturn raw_block.replace(/./g, function(char) {\n\t\t\treturn '\\\\' + char;\n\t\t});\n\t},\n\n\tdestroy: function() {\n\t\tthis.running = false;\n\t\tXKit.tools.remove_css('alternative_timestamps');\n\n\t\tXKit.post_listener.remove('alternative_timestamps_insert');\n\n\t\tthis.remove_timestamps();\n\t},\n\n\tcpanel: function($panel) {\n\t\t$.each(this.format_syntax, function(code, description) {\n\t\t\tvar $syntax_line = $('<div>');\n\t\t\t$syntax_line.addClass('xkit-extension-setting');\n\t\t\t$syntax_line.append($('<div>').addClass('title').text(code));\n\t\t\t$syntax_line.append($('<div>').text(description));\n\t\t\t$syntax_line.append($('<div>').addClass('alternative_timestamps_preview').text(XKit.extensions.alternative_timestamps.render_timestamp(moment(), code)));\n\n\t\t\t$panel.append($syntax_line);\n\t\t});\n\t},\n\n\tformat_syntax: {\n\t\t'[text]': 'Raw text block',\n\t\t'RR': 'Relative timestamp',\n\t\t'M': 'Month number',\n\t\t'Mo': 'Month number with ordinal',\n\t\t'MM': 'Month number with leading 0',\n\t\t'MMM': 'Month name, short',\n\t\t'MMMM': 'Month name, full',\n\t\t'D': 'Day of month number',\n\t\t'Do': 'Day of month number with ordinal',\n\t\t'DD': 'Day of month number with leading 0',\n\t\t'DDD': 'Day of year number',\n\t\t'DDDo': 'Day of year number with ordinal',\n\t\t'DDDD': 'Day of year number with leading 0s',\n\t\t'd': 'Day of week number',\n\t\t'do': 'Day of week number with ordinal',\n\t\t'ddd': 'Day of week name, short',\n\t\t'dddd': 'Day of week name, full',\n\t\t'w': 'Week of year number',\n\t\t'wo': 'Week of year number with ordinal',\n\t\t'ww': 'Week of year number with leading 0',\n\t\t'YY': 'Year without centuries',\n\t\t'YYYY': 'Year with centuries',\n\t\t'a': 'am/pm',\n\t\t'A': 'AM/PM',\n\t\t'H': 'Hour, 24-hour time',\n\t\t'HH': 'Hour with leading 0, 24-hour time',\n\t\t'h': 'Hour, 12-hour time',\n\t\t'hh': 'Hour with leading 0, 12-hour time',\n\t\t'm': 'Minute',\n\t\t'mm': 'Minute with leading 0'\n\t}\n});\n","file":"found","server":"up","errors":false,"icon":"data:image/png;base64,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\n","css":".alternative_timestamp {\n\tfont-size: 11px;\n\tfont-weight: normal;\n\tcolor: rgb(168,177,184);\n\tclear:left;\n\tmargin-bottom: 10px;\n}\n\n.old_tumblr_done .alternative_timestamp {\n\t/* compatibility hack */\n\tmargin: -0.3em 0 0.7em;\n}\n\n.alternative_timestamps_preview {\n\tfont-style: italic;\n}","title":"Alternative Timestamps","description":"Adds timestamps to dashboard posts using a parsing method","developer":"jesskay","version":"1.1.2","details":"This version of Timestamps uses parsing methods to display the timestamp instead of AJAX calls. Currently only in English.","frame":"false","beta":"true","slow":"false"}