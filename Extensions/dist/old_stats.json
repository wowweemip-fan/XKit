{"id":"old_stats","script":"//* TITLE Old Stats **//\n//* VERSION 0.5.0 **//\n//* DESCRIPTION Blog stats where they were **//\n//* DEVELOPER New-XKit **//\n//* FRAME false **//\n//* BETA false **//\n\nXKit.extensions.old_stats = new Object({\n\n\trunning: false,\n\tdone: false,\n\tblogs: {},\n\n\tpreferences: {\n\t\t\"iconify\": {\n\t\t\ttext: \"Put the icons back on posts/followers/etc links\",\n\t\t\tdefault: true,\n\t\t\tvalue: true\n\t\t},\n\t\t\"switcher\": {\n\t\t\ttext: \"Show the blog switcher\",\n\t\t\texperimental: true,\n\t\t\tdefault: true,\n\t\t\tvalue: true\n\t\t}\n\t},\n\n\trun: function() {\n\t\tthis.running = true;\n\t\tif (this.preferences.iconify.value) {\n\t\t\tXKit.tools.init_css(\"old_stats\");\n\t\t}\n\t\tif (this.preferences.switcher.value) {\n\t\t\twindow.addEventListener(\"message\", this.messageListener);\n\t\t\tXKit.tools.add_css(`\n\t\t\t\t#old_stats_switcher::before {\n\t\t\t\t\tcontent: \"\\\\EA07\";\n\t\t\t\t\tfont-family: tumblr-icons, Blank;\n\t\t\t\t\tcolor: hsla(0,0%,100%,.6);\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\ttop: calc(50% - 0.5em);\n\t\t\t\t\tright: calc(10px + 0.5em);\n\t\t\t\t\ttransition: transform 0.1s;\n\t\t\t\t}\n\t\t\t\t#old_stats_switcher.active::before {\n\t\t\t\t\tcolor: unset;\n\t\t\t\t\ttransform: rotate(180deg);\n\t\t\t\t}\n\t\t\t\t.old_stats_blog { cursor: pointer; }`,\n\t\t\t\"old_stats_switcher\");\n\t\t}\n\t\tif ($(\"#dashboard_controls_open_blog\").length) {\n\t\t\tif (this.preferences.switcher.value) {\n\t\t\t\tthis.blogScraper();\n\t\t\t}\n\t\t} else if ($(\".recommended_tumblelogs\").length) {\n\t\t\tthis.fetchStats();\n\t\t}\n\t},\n\n\tfetchStats: function(blog) {\n\n\t\tvar page;\n\n\t\tif (blog) {\n\t\t\tpage = \"blog/\" + blog;\n\t\t} else {\n\t\t\tpage = \"likes\";\n\t\t}\n\n\t\tGM_xmlhttpRequest({\n\t\t\tmethod: \"GET\",\n\t\t\turl: \"https://www.tumblr.com/\" + page,\n\t\t\tonerror: function(response) {\n\t\t\t\tconsole.error(\"[Old Stats] Couldn't fetch blog info.\");\n\t\t\t},\n\t\t\tonload: function(response) {\n\t\t\t\t$(\"#dashboard_controls_open_blog, .small_links\").remove();\n\t\t\t\t$(\"#right_column\").prepend($(\".small_links\", response.responseText).css(\"margin\", \"0 0 18px\")).prepend($(\"#dashboard_controls_open_blog\", response.responseText));\n\t\t\t\t$(\"#dashboard_controls_open_blog .selected\").removeClass(\"selected\");\n\t\t\t\t$(\"#dashboard_controls_open_blog [data-sparkline]\").prepend('<canvas id=\"old_stats_canvas\" width=\"72\" height=\"30\" style=\"display: inline-block; width: 36px; height: 15px; vertical-align: top;\">');\n\t\t\t\ttry {\n\t\t\t\t\tvar sparkline = JSON.parse($(\"#dashboard_controls_open_blog [data-sparkline]\").attr(\"data-sparkline\"));\n\t\t\t\t\tvar sparkmin = Math.min.apply(Math, sparkline);\n\t\t\t\t\tvar sparkpx = (Math.max.apply(Math, sparkline) - sparkmin) / 30;\n\t\t\t\t\tvar canvas = document.getElementById(\"old_stats_canvas\").getContext(\"2d\");\n\t\t\t\t\tcanvas.strokeStyle = \"#FFFFFF\";\n\t\t\t\t\tcanvas.lineWidth = 3.5;\n\t\t\t\t\tcanvas.moveTo(0, 30 - ((sparkline[0] - sparkmin) / sparkpx));\n\t\t\t\t\tfor (var i = 1; i < sparkline.length; i++) {\n\t\t\t\t\t\tcanvas.lineTo(i * (72 / sparkline.length), 30 - ((sparkline[i] - sparkmin) / sparkpx));\n\t\t\t\t\t\tcanvas.stroke();\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {} // No activity, no problem.\n\t\t\t\tif (XKit.extensions.old_stats.preferences.switcher.value) { XKit.extensions.old_stats.blogScraper(); }\n\t\t\t\tXKit.extensions.old_stats.done = true;\n\t\t\t}\n\t\t});\n\n\t},\n\n\tblogScraper: function() {\n\t\tif (Object.keys(this.blogs).length) { this.initSwitcher(); return; }\n\t\tXKit.tools.add_function(function() {\n\t\t\ttry {\n\t\t\t\tvar models = Tumblr.dashboardControls.allTumblelogs, blogs = {};\n\t\t\t\tmodels.filter(function(model) {\n\t\t\t\t\treturn model.attributes.hasOwnProperty(\"is_current\");\n\t\t\t\t}).forEach(function(model) {\n\t\t\t\t\tblogs[model.attributes.name] = model.attributes.directory_safe_title;\n\t\t\t\t});\n\t\t\t\twindow.postMessage({\n\t\t\t\t\txkit_blogs_with_names: blogs\n\t\t\t\t}, window.location.protocol + \"//\" + window.location.host);\n\t\t\t} catch (e) { console.error(e.message); }\n\t\t}, true);\n\t},\n\n\tmessageListener: function(e) {\n\t\tif (e.origin == window.location.protocol + \"//\" + window.location.host && e.data.hasOwnProperty(\"xkit_blogs_with_names\")) {\n\t\t\twindow.removeEventListener(\"message\", this.messageListener);\n\t\t\tXKit.extensions.old_stats.blogs = e.data.xkit_blogs_with_names;\n\t\t\tXKit.extensions.old_stats.initSwitcher();\n\t\t}\n\t},\n\n\tinitSwitcher: function() {\n\t\tvar blogs = this.blogs;\n\t\tif (!Object.keys(blogs).length) { return; }\n\n\t\t$(\".no_push.selected_blog\").append('<span id=\"old_stats_switcher\"></span>');\n\n\t\tvar loading = false;\n\t\t$(\"#old_stats_switcher\").click(function() {\n\t\t\tif (document.selection) {\n\t\t\t\tdocument.selection.empty();\n\t\t\t} else if (window.getSelection) {\n\t\t\t\twindow.getSelection().removeAllRanges();\n\t\t\t}\n\t\t\tif ($(this).hasClass(\"active\")) {\n\t\t\t\t$(\".old_stats_blog\").off(\"click\").remove();\n\t\t\t\tif (!loading) {\n\t\t\t\t\t$(\"#dashboard_controls_open_blog\").children().removeAttr(\"style\");\n\t\t\t\t\t$(\".small_links\").removeAttr(\"style\").css(\"margin\", \"0 0 18px\");\n\t\t\t\t} else {\n\t\t\t\t\t$(\"#dashboard_controls_open_blog\").append(\n\t\t\t\t\t\t'<li class=\"controls_section_item selected_blog\">' +\n\t\t\t\t\t\t\t'<a class=\"control-item control-anchor\">' +\n\t\t\t\t\t\t\t\t'<div class=\"hide_overflow\">Loading...</div>' +\n\t\t\t\t\t\t\t'</a>' +\n\t\t\t\t\t\t'</li>');\n\t\t\t\t}\n\t\t\t\tloading = false;\n\t\t\t} else {\n\t\t\t\t$(\"#dashboard_controls_open_blog\").children(\":not(.selected_blog)\").css(\"display\", \"none\");\n\t\t\t\t$(\".small_links\").css(\"display\", \"none\");\n\t\t\t\tvar current_blog = $(\".no_push.selected_blog .currently_selected_blog\").html(), do_append = false;\n\n\t\t\t\tfor (var x in blogs) {\n\t\t\t\t\tif (x == current_blog) { do_append = true; continue; }\n\t\t\t\t\tvar blog_html =\n\t\t\t\t\t\t'<li class=\"no_push old_stats_blog\">' +\n\t\t\t\t\t\t\t'<div class=\"open_blog with_subtitle\">' +\n\t\t\t\t\t\t\t\t'<a class=\"currently_selected_blog hide_overflow blog_title\">' + x + '</a>' +\n\t\t\t\t\t\t\t\t'<small>' +\n\t\t\t\t\t\t\t\t\t'<div class=\"hide_overflow\">' +\n\t\t\t\t\t\t\t\t\t\t'<span class=\"open_blog_link\" href=\"https://' + x + '.tumblr.com/\" data-peepr=\"{&quot;tumblelog&quot;:&quot;' + x + '&quot;}\">' + blogs[x] + '</span>' +\n\t\t\t\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\t\t\t'</small>' +\n\t\t\t\t\t\t\t'</div>' +\n\t\t\t\t\t\t'</li>';\n\t\t\t\t\tif (do_append) {\n\t\t\t\t\t\t$(\".no_push.selected_blog, .no_push.old_stats_blog\").last().after(blog_html);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$(\".no_push.selected_blog, .no_push.old_stats_blog\").last().before(blog_html);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t$(\".no_push.selected_blog, .no_push.old_stats_blog\").last().css(\"margin\", \"0 0 18px\");\n\n\t\t\t\t$(\".old_stats_blog\").click(function() {\n\t\t\t\t\t$(\".no_push.selected_blog .open_blog.with_subtitle\")[0].outerHTML = this.firstChild.outerHTML.replace(\"span\", \"a\");\n\t\t\t\t\tloading = true;\n\t\t\t\t\t$(\"#old_stats_switcher\").click();\n\t\t\t\t\tXKit.extensions.old_stats.fetchStats($(this).find(\".currently_selected_blog\").html());\n\t\t\t\t});\n\t\t\t}\n\t\t\t$(this).toggleClass(\"active\");\n\t\t});\n\t},\n\n\tdestroy: function() {\n\t\tthis.running = false;\n\t\tXKit.tools.remove_css(\"old_stats\");\n\t\tif (this.done) {\n\t\t\t$(\"#dashboard_controls_open_blog, .small_links\").remove();\n\t\t}\n\t}\n});\n","file":"found","server":"up","errors":false,"css":".control-item.control-anchor .hide_overflow::before {\n\tfont-family: tumblr-icons, None;\n\tfont-size: 24px;\n\tline-height: 0;\n\tfont-weight: normal;\n\tposition: relative;\n\ttop: 3px; left: 1px;\n}\n\n.control-item.control-anchor.posts .hide_overflow::before {\n\tcontent: \"\\EA8B\\2002\";\n}\n.control-item.control-anchor.followers .hide_overflow::before {\n\tcontent: \"\\EA44\\2002\";\n}\n.control-item.control-anchor.activity .hide_overflow::before {\n\tcontent: \"\\EA01\\2002\";\n\tleft: 5px;\n\tmargin-right: 11px;\n}\n.control-item.control-anchor.members .hide_overflow::before {\n\tcontent: \"\\EA59\\2002\";\n\tfont-size: 21px;\n\ttop: 2px; left: 2px;\n\tmargin-right: 5px;\n}\n.control-item.control-anchor.queue .hide_overflow::before {\n\tcontent: \"\\EA8D\\2002\";\n\tleft: -1px;\n}\n.control-item.control-anchor.drafts .hide_overflow::before {\n\tcontent: \"\\EA25\\2002\";\n}\n.control-item.control-anchor.processing .hide_overflow::before {\n\tcontent: \"\\EA8C\\2002\";\n}\n.control-item.control-anchor.customize .hide_overflow::before {\n\tcontent: \"\\EAB3\\2002\";\n}\n","title":"Old Stats","description":"Blog stats where they were","developer":"New-XKit","version":"0.5.0","frame":"false","beta":"false","slow":"false"}